# Email Service

This example demonstrates how to use the `EmailComprehensiveService` and `WebmailService` to build a fully functional email system within the SEED Emulator.

## Files

- **email_simple_v2.py**: The reference implementation, building a dual-domain email system (qq.com and gmail.com) using the new standard architecture.

## üìö Documentation

- [Design Document](./EMAIL_SERVICE_DESIGN.md) - Detailed service design, philosophy, and API implementation.

---

## ‚úÖ email_simple_v2.py - Reference Implementation

A simple dual-domain email system (qq.com and gmail.com) demonstrating core functionalities.

### Features

- ‚úÖ Standard Service/Server Architecture
- ‚úÖ DNS-first Routing Mode (via MX records)
- ‚úÖ Automatic DNS Record Publishing
- ‚úÖ Roundcube Webmail Interface
- ‚úÖ Compliant with SEED Emulator Architecture
- ‚úÖ Internet Map: http://localhost:8080/map.html

### Quick Start

```bash
# Set PYTHONPATH
export PYTHONPATH=/home/parallels/seed-email-service:$PYTHONPATH

# Run the emulation script
cd /home/parallels/seed-email-service/examples/internet/B29_email_dns
python3 email_simple_v2.py auto

# Start containers
cd output_v2
docker-compose up -d

# Check container status
docker-compose ps
```

### Access Services

- **QQ Webmail**: http://localhost:18080/roundcube
  - User: user@qq.com
  - Password: password123

- **Gmail Webmail**: http://localhost:18081/roundcube
  - User: user@gmail.com
  - Password: password123

- **Internet Map**: http://localhost:8080/map.html

### Testing Email Functionality

```bash
# Send a test email
docker exec -it as200h-mail-10.200.0.71 bash -c 'echo "Test from QQ to Gmail" | mail -s "Test" user@gmail.com'

# Check mailbox at destination
docker exec -it as201h-mail-10.201.0.71 ls /home/user/Maildir/new/

# View mail logs
docker exec -it as200h-mail-10.200.0.71 tail -f /var/log/mail.log
```

**Note**: The container names (e.g., `as200h-mail-10.200.0.71`) in the commands above are generated by `email_simple_v2.py` and depend on the IP addresses assigned.

### Cleanup

```bash
cd output_v2
docker-compose down -v
```

---

## üîß Service Architecture

### EmailComprehensiveService

A standard email service implementation based on Postfix (MTA) and Dovecot (IMAP).

**Key Features**:
- Follows the standard Service/Server pattern.
- Supports both **DNS-first** and **Transport** routing modes.
- Optional integration with `DomainNameService` for automatic MX record publishing.
- Uses System Users + Maildir storage format.
- Configures nodes via standard Node APIs (`node.addSoftware`, `node.appendStartCommand`, `node.setFile`).

### WebmailService

Roundcube Webmail service providing a web-based email client.

**Key Features**:
- Follows the standard Service/Server pattern.
- Stack: Apache + PHP + Roundcube + SQLite.
- Automatically resolves `vnode` names to IP addresses for IMAP/SMTP targets.
- Access path: `/roundcube`.

For more details, please refer to [EMAIL_SERVICE_DESIGN.md](./EMAIL_SERVICE_DESIGN.md).

---

## üìù Notes

- **Classroom Configuration**: This setup uses plain text passwords and open relays for demonstration simplicity. **DO NOT USE IN PRODUCTION**.
- **Port Mapping**: Ensure ports 18080, 18081, and 8080 are not occupied on your host machine.
- **Resources**: Requires at least 4GB RAM (8GB recommended).
- **Single Instance**: Run only one Internet Map instance at a time to avoid port conflicts.

---

## üìö Resources

- [SEED Emulator GitHub](https://github.com/seed-labs/seed-emulator)
- [Postfix Documentation](http://www.postfix.org/documentation.html)
- [Dovecot Wiki](https://wiki.dovecot.org/)
- [Roundcube Documentation](https://github.com/roundcube/roundcubemail/wiki)
