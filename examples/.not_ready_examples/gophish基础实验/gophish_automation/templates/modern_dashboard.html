<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¯ AIé’“é±¼ç®¡ç†å¹³å°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f8fafc;
            color: #1e293b;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 24px;
        }
        
        .header {
            margin-bottom: 32px;
        }
        
        .header h1 {
            font-size: 2rem;
            font-weight: 700;
            color: #0f172a;
            margin-bottom: 8px;
        }
        
        .header p {
            color: #64748b;
            font-size: 1rem;
        }
        
        .status-bar {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 16px;
        }
        
        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }
        
        .status-online {
            background: #10b981;
        }
        
        .status-offline {
            background: #ef4444;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 24px;
            margin-bottom: 24px;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
        }
        
        .card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .card-icon {
            font-size: 1.5rem;
        }
        
        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #0f172a;
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
        }
        
        .btn-primary {
            background: #3b82f6;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2563eb;
        }
        
        .btn-success {
            background: #10b981;
            color: white;
        }
        
        .btn-success:hover {
            background: #059669;
        }
        
        .btn-warning {
            background: #f59e0b;
            color: white;
        }
        
        .btn-warning:hover {
            background: #d97706;
        }
        
        .btn-outline {
            background: transparent;
            color: #3b82f6;
            border: 1px solid #3b82f6;
        }
        
        .btn-outline:hover {
            background: #3b82f6;
            color: white;
        }
        
        .form-group {
            margin-bottom: 16px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #374151;
        }
        
        .form-input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 0.875rem;
            transition: border-color 0.2s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }
        
        .form-select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 0.875rem;
            background: white;
        }
        
        .server-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
            margin-bottom: 16px;
        }
        
        .server-option {
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .server-option:hover {
            border-color: #3b82f6;
        }
        
        .server-option.selected {
            border-color: #3b82f6;
            background: #dbeafe;
        }
        
        .server-icon {
            font-size: 1.5rem;
            margin-bottom: 4px;
        }
        
        .server-name {
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .server-port {
            font-size: 0.625rem;
            color: #6b7280;
        }
        
        .risk-badge {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.625rem;
            font-weight: 500;
            margin-top: 4px;
        }
        
        .risk-low {
            background: #d1fae5;
            color: #065f46;
        }
        
        .risk-medium {
            background: #fef3c7;
            color: #92400e;
        }
        
        .risk-high {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .risk-critical {
            background: #fde2e7;
            color: #7f1d1d;
        }
        
        .template-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
        }
        
        .template-item {
            padding: 12px;
            border-bottom: 1px solid #f1f5f9;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .template-item:hover {
            background: #f8fafc;
        }
        
        .template-item.selected {
            background: #dbeafe;
        }
        
        .template-subject {
            font-weight: 500;
            margin-bottom: 4px;
        }
        
        .template-meta {
            font-size: 0.75rem;
            color: #6b7280;
        }
        
        .progress-bar {
            width: 100%;
            height: 6px;
            background: #f1f5f9;
            border-radius: 3px;
            overflow: hidden;
            margin: 8px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: #3b82f6;
            transition: width 0.3s;
        }
        
        .alert {
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 16px;
            font-size: 0.875rem;
        }
        
        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }
        
        .alert-error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fca5a5;
        }
        
        .upload-area {
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            padding: 24px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .upload-area:hover {
            border-color: #3b82f6;
            background: #f8fafc;
        }
        
        .upload-area.dragover {
            border-color: #3b82f6;
            background: #dbeafe;
        }
        
        .upload-icon {
            font-size: 2rem;
            color: #6b7280;
            margin-bottom: 8px;
        }
        
        .upload-text {
            color: #6b7280;
            font-size: 0.875rem;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }
        
        .stat {
            text-align: center;
        }
        
        .stat-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: #0f172a;
        }
        
        .stat-label {
            font-size: 0.75rem;
            color: #6b7280;
            margin-top: 4px;
        }
        
        .loading {
            display: none;
            color: #6b7280;
        }
        
        .hidden {
            display: none;
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .floating-action {
            position: fixed;
            bottom: 24px;
            right: 24px;
            z-index: 1000;
        }
        
        .floating-btn {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: #3b82f6;
            color: white;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.2s;
        }
        
        .floating-btn:hover {
            background: #2563eb;
            transform: scale(1.1);
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 16px;
            }
            
            .grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            .status-bar {
                flex-direction: column;
                align-items: stretch;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>ğŸ¯ AIé’“é±¼ç®¡ç†å¹³å°</h1>
            <p>ç°ä»£åŒ–ã€æ™ºèƒ½åŒ–çš„é’“é±¼å®‰å…¨æµ‹è¯•ç®¡ç†å¹³å°</p>
        </div>

        <!-- Status Bar -->
        <div class="status-bar">
            <div class="status-item">
                <div class="status-indicator {{ 'status-online' if system_status.gophish else 'status-offline' }}"></div>
                <span>Gophish {{ 'Online' if system_status.gophish else 'Offline' }}</span>
            </div>
            <div class="status-item">
                <div class="status-indicator {{ 'status-online' if system_status.ai_ready else 'status-offline' }}"></div>
                <span>AIç”Ÿæˆå™¨ {{ 'Ready' if system_status.ai_ready else 'Error' }}</span>
            </div>
            <div class="stats">
                <div class="stat">
                    <div class="stat-number">{{ system_status.active_campaigns }}</div>
                    <div class="stat-label">æ´»è·ƒæ´»åŠ¨</div>
                </div>
                <div class="stat">
                    <div class="stat-number">{{ system_status.total_templates }}</div>
                    <div class="stat-label">é‚®ä»¶æ¨¡æ¿</div>
                </div>
                <div class="stat">
                    <div class="stat-number">{{ system_status.total_groups }}</div>
                    <div class="stat-label">ç”¨æˆ·ç»„</div>
                </div>
            </div>
            <div>
                <span style="font-size: 0.875rem; color: #6b7280;">{{ system_status.timestamp }}</span>
            </div>
        </div>

        <!-- Alert Area -->
        <div id="alert-area"></div>

        <!-- Main Grid -->
        <div class="grid">
            <!-- Create Group -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">ğŸ‘¥</div>
                    <div class="card-title">åˆ›å»ºç”¨æˆ·ç»„</div>
                </div>
                
                <form id="create-group-form">
                    <div class="form-group">
                        <label class="form-label">ç»„å</label>
                        <input type="text" class="form-input" name="group_name" placeholder="è¾“å…¥ç”¨æˆ·ç»„åç§°" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">é‚®ç®±åœ°å€ (æ¯è¡Œä¸€ä¸ªæˆ–ç”¨é€—å·åˆ†éš”)</label>
                        <textarea class="form-input form-textarea" name="emails" placeholder="user1@example.com&#10;user2@example.com&#10;user3@example.com" required></textarea>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">
                        <span>âœ¨</span>
                        åˆ›å»ºç”¨æˆ·ç»„
                    </button>
                </form>
            </div>

            <!-- AI Content Generation -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">ğŸ¤–</div>
                    <div class="card-title">AIå†…å®¹ç”Ÿæˆ</div>
                </div>
                
                <form id="generate-content-form">
                    <div class="form-group">
                        <label class="form-label">å†…å®¹ç±»å‹</label>
                        <select class="form-select" name="content_type" required>
                            <option value="email">ğŸ“§ é’“é±¼é‚®ä»¶</option>
                            <option value="page">ğŸŒ é’“é±¼é¡µé¢</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">åœºæ™¯ç±»å‹</label>
                        <select class="form-select" name="scenario_type">
                            <option value="security_alert">ğŸ”’ å®‰å…¨è­¦å‘Š</option>
                            <option value="system_update">ğŸ”„ ç³»ç»Ÿæ›´æ–°</option>
                            <option value="account_verification">âœ… è´¦æˆ·éªŒè¯</option>
                            <option value="urgent_action">âš ï¸ ç´§æ€¥æ“ä½œ</option>
                            <option value="reward_notification">ğŸ å¥–åŠ±é€šçŸ¥</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">ç›®æ ‡å…¬å¸</label>
                        <input type="text" class="form-input" name="company_name" value="XXç§‘æŠ€å…¬å¸" required>
                    </div>
                    
                    <div class="form-group" id="page-options" style="display: none;">
                        <label class="form-label">é¡µé¢ç±»å‹</label>
                        <select class="form-select" name="page_type">
                            <option value="login">ğŸ” ç™»å½•é¡µé¢</option>
                            <option value="verification">ğŸ›¡ï¸ éªŒè¯é¡µé¢</option>
                            <option value="update_info">ğŸ“ ä¿¡æ¯æ›´æ–°</option>
                        </select>
                        
                        <label class="form-label" style="margin-top: 12px;">è®¾è®¡é£æ ¼</label>
                        <select class="form-select" name="style">
                            <option value="modern">âœ¨ ç°ä»£é£æ ¼</option>
                            <option value="corporate">ğŸ¢ ä¼ä¸šé£æ ¼</option>
                            <option value="minimal">ğŸ“± ç®€çº¦é£æ ¼</option>
                        </select>
                        
                        <div style="margin-top: 15px; padding: 15px; background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px;">
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; font-weight: bold; color: #856404;">
                                <input type="checkbox" name="advanced_attacks" value="true" style="margin: 0;">
                                ğŸ¯ å¯ç”¨é«˜çº§æ”»å‡»æ¼”ç¤º
                            </label>
                            <div style="font-size: 12px; color: #856404; margin-top: 5px; line-height: 1.4;">
                                åŒ…å«æ ‡ç­¾é¡µåŠ«æŒã€æµè§ˆå™¨æŒ‡çº¹è¯†åˆ«ã€Cookieçªƒå–ã€ä¼šè¯åŠ«æŒç­‰çœŸå®æ”»å‡»æŠ€æœ¯æ¼”ç¤º
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="checkbox" name="use_real_template" value="true">
                            <span class="form-label" style="margin: 0;">ä½¿ç”¨çœŸå®é‚®ä»¶æ¨¡æ¿å¢å¼º</span>
                        </label>
                    </div>
                    
                    <div class="form-group" id="real-template-select" style="display: none;">
                        <label class="form-label">é€‰æ‹©å‚è€ƒé‚®ä»¶</label>
                        <select class="form-select" name="reference_template">
                            {% for template in real_templates %}
                            <option value="{{ template.filename }}">{{ template.subject }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <button type="submit" class="btn btn-success">
                        <span>ğŸš€</span>
                        ç”Ÿæˆå†…å®¹
                    </button>
                </form>
            </div>

            <!-- Upload Template -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">ğŸ“¤</div>
                    <div class="card-title">ä¸Šä¼ æ¨¡æ¿</div>
                </div>
                
                <form id="upload-form" enctype="multipart/form-data">
                    <div class="upload-area" onclick="document.getElementById('file-input').click()">
                        <div class="upload-icon">ğŸ“</div>
                        <div class="upload-text">
                            ç‚¹å‡»æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„<br>
                            <small>æ”¯æŒ .eml, .html, .txt, .json æ ¼å¼</small>
                        </div>
                        <input type="file" id="file-input" name="file" accept=".eml,.html,.txt,.json" style="display: none;">
                    </div>
                    
                    <button type="submit" class="btn btn-primary" style="margin-top: 12px;">
                        <span>ğŸ“¤</span>
                        ä¸Šä¼ æ¨¡æ¿
                    </button>
                </form>
            </div>

            <!-- Real Email Templates -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">ğŸ“¬</div>
                    <div class="card-title">çœŸå®é‚®ä»¶æ¨¡æ¿</div>
                </div>
                
                <div class="template-list">
                    {% for template in real_templates %}
                    <div class="template-item">
                        <div class="template-subject">{{ template.subject }}</div>
                        <div class="template-meta">
                            å‘ä»¶äºº: {{ template.sender }}<br>
                            å¤§å°: {{ "%.1f"|format(template.size / 1024) }} KB
                        </div>
                        <div style="margin-top: 8px; display: flex; gap: 8px;">
                            <button class="btn btn-outline" style="font-size: 0.75rem; padding: 4px 8px;" onclick="analyzeRealEmail('{{ template.filename }}')">
                                ğŸ“‹ åˆ†æ
                            </button>
                            <button class="btn btn-warning" style="font-size: 0.75rem; padding: 4px 8px;" onclick="showSendRealEmailModal('{{ template.filename }}', '{{ template.subject }}')">
                                {% if 'metamask' in template.filename.lower() or 'ç›‘æ§' in template.filename %}
                                ğŸ¯ å‘é€MetaMaské’“é±¼
                                {% elif 'aws' in template.filename.lower() %}
                                â˜ï¸ å‘é€AWSé’“é±¼
                                {% else %}
                                ğŸ“§ ç›´æ¥å‘é€
                                {% endif %}
                            </button>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                
                <button class="btn btn-outline" style="margin-top: 12px;" onclick="refreshTemplates()">
                    <span>ğŸ”„</span>
                    åˆ·æ–°åˆ—è¡¨
                </button>
            </div>

            <!-- Send Real Email Modal -->
            <div id="send-real-email-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; justify-content: center; align-items: center;">
                <div style="background: white; border-radius: 12px; padding: 24px; max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 20px;">
                        <h3 style="margin: 0;">ğŸ¯ å‘é€çœŸå®é‚®ä»¶</h3>
                        <button onclick="closeSendRealEmailModal()" style="border: none; background: none; font-size: 1.5rem; cursor: pointer;">Ã—</button>
                    </div>
                    
                    <form id="send-real-email-form">
                        <input type="hidden" name="filename" id="modal-filename">
                        
                        <div class="form-group">
                            <label class="form-label">é€‰ä¸­é‚®ä»¶</label>
                            <div id="modal-email-info" style="background: #f8fafc; padding: 12px; border-radius: 6px; font-size: 0.875rem;"></div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">æ´»åŠ¨åç§°</label>
                            <input type="text" class="form-input" name="campaign_name" id="modal-campaign-name" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">ç›®æ ‡ç”¨æˆ·ç»„</label>
                            <select class="form-select" name="group_id" id="modal-group-select" required>
                                <option value="">é€‰æ‹©ç”¨æˆ·ç»„</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">æ”»å‡»æœåŠ¡å™¨</label>
                            <div class="server-grid">
                                {% for key, server in attack_servers.items() %}
                                <div class="server-option" data-server="{{ key }}" onclick="selectModalServer('{{ key }}')">
                                    <div class="server-icon">{{ server.icon }}</div>
                                    <div class="server-name">{{ server.name }}</div>
                                    <div class="server-port">:{{ server.port }}</div>
                                    <div class="risk-badge risk-{{ server.risk }}">{{ server.risk.upper() }}</div>
                                </div>
                                {% endfor %}
                            </div>
                            <input type="hidden" name="attack_server" id="modal-selected-server" value="xss">
                        </div>
                        
                        <div style="display: flex; gap: 12px; margin-top: 20px;">
                            <button type="button" class="btn btn-outline" onclick="closeSendRealEmailModal()">
                                å–æ¶ˆ
                            </button>
                            <button type="submit" class="btn btn-warning">
                                <span>ğŸš€</span>
                                å‘é€çœŸå®é‚®ä»¶
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Launch Campaign -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">ğŸ¯</div>
                    <div class="card-title">å¯åŠ¨é’“é±¼æ´»åŠ¨</div>
                </div>
                
                <form id="launch-campaign-form">
                    <div class="form-group">
                        <label class="form-label">æ´»åŠ¨åç§°</label>
                        <input type="text" class="form-input" name="campaign_name" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">ç”¨æˆ·ç»„</label>
                        <select class="form-select" name="group_id" id="group-select" required>
                            <option value="">é€‰æ‹©ç”¨æˆ·ç»„</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">é‚®ä»¶æ¨¡æ¿</label>
                        <select class="form-select" name="template_id" id="template-select" required>
                            <option value="">é€‰æ‹©é‚®ä»¶æ¨¡æ¿</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">é’“é±¼é¡µé¢</label>
                        <select class="form-select" name="page_id" id="page-select" required>
                            <option value="">é€‰æ‹©é’“é±¼é¡µé¢</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">æ”»å‡»æœåŠ¡å™¨</label>
                        <div class="server-grid">
                            {% for key, server in attack_servers.items() %}
                            <div class="server-option" data-server="{{ key }}" onclick="selectServer('{{ key }}')">
                                <div class="server-icon">{{ server.icon }}</div>
                                <div class="server-name">{{ server.name }}</div>
                                <div class="server-port">:{{ server.port }}</div>
                                <div class="risk-badge risk-{{ server.risk }}">{{ server.risk.upper() }}</div>
                            </div>
                            {% endfor %}
                        </div>
                        <input type="hidden" name="attack_server" id="selected-server" value="xss">
                    </div>
                    
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="checkbox" name="send_immediately" value="true" checked>
                            <span class="form-label" style="margin: 0;">ç«‹å³å‘é€</span>
                        </label>
                    </div>
                    
                    <button type="submit" class="btn btn-warning">
                        <span>ğŸš€</span>
                        å¯åŠ¨æ´»åŠ¨
                    </button>
                </form>
            </div>

            <!-- Batch Operations -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">âš¡</div>
                    <div class="card-title">æ‰¹é‡æ“ä½œ</div>
                </div>
                
                <div style="display: flex; flex-direction: column; gap: 12px;">
                    <button class="btn btn-primary" onclick="batchOperation('create_demo_environment')">
                        <span>ğŸ—ï¸</span>
                        åˆ›å»ºæ¼”ç¤ºç¯å¢ƒ
                    </button>
                    
                    <button class="btn btn-success" onclick="batchOperation('generate_multiple_templates')">
                        <span>ğŸ“</span>
                        æ‰¹é‡ç”Ÿæˆæ¨¡æ¿
                    </button>
                    
                    <a href="https://localhost:3333" target="_blank" class="btn btn-outline">
                        <span>ğŸ£</span>
                        æ‰“å¼€Gophish
                    </a>
                    
                    <a href="/quick_attack" class="btn btn-outline">
                        <span>âš¡</span>
                        å¿«é€Ÿæ”»å‡»
                    </a>
                </div>
            </div>
        </div>

        <!-- Floating Action Button -->
        <div class="floating-action">
            <button class="floating-btn" onclick="refreshAll()" title="åˆ·æ–°æ‰€æœ‰æ•°æ®">
                ğŸ”„
            </button>
        </div>
    </div>

    <script>
        // Global state
        let selectedServer = 'xss';
        let modalSelectedServer = 'xss';
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadResources();
            setupEventListeners();
            selectServer('xss'); // Default selection
            selectModalServer('xss'); // Default selection for modal
        });
        
        function setupEventListeners() {
            // Content type change
            document.querySelector('select[name="content_type"]').addEventListener('change', function() {
                const pageOptions = document.getElementById('page-options');
                pageOptions.style.display = this.value === 'page' ? 'block' : 'none';
            });
            
            // Real template checkbox
            document.querySelector('input[name="use_real_template"]').addEventListener('change', function() {
                const templateSelect = document.getElementById('real-template-select');
                templateSelect.style.display = this.checked ? 'block' : 'none';
            });
            
            // File upload drag and drop
            const uploadArea = document.querySelector('.upload-area');
            
            uploadArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                this.classList.add('dragover');
            });
            
            uploadArea.addEventListener('dragleave', function(e) {
                e.preventDefault();
                this.classList.remove('dragover');
            });
            
            uploadArea.addEventListener('drop', function(e) {
                e.preventDefault();
                this.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    document.getElementById('file-input').files = files;
                }
            });
            
            // Form submissions
            document.getElementById('create-group-form').addEventListener('submit', handleCreateGroup);
            document.getElementById('generate-content-form').addEventListener('submit', handleGenerateContent);
            document.getElementById('upload-form').addEventListener('submit', handleUpload);
            document.getElementById('launch-campaign-form').addEventListener('submit', handleLaunchCampaign);
            document.getElementById('send-real-email-form').addEventListener('submit', handleSendRealEmail);
        }
        
        function selectServer(serverKey) {
            // Remove previous selection
            document.querySelectorAll('.server-option').forEach(el => el.classList.remove('selected'));
            
            // Add selection to clicked server
            document.querySelector(`[data-server="${serverKey}"]`).classList.add('selected');
            
            // Update hidden input
            document.getElementById('selected-server').value = serverKey;
            selectedServer = serverKey;
        }
        
        function showAlert(message, type = 'success') {
            const alertArea = document.getElementById('alert-area');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type} fade-in`;
            alert.textContent = message;
            
            alertArea.appendChild(alert);
            
            setTimeout(() => {
                alert.remove();
            }, 5000);
        }
        
        function loadResources() {
            fetch('/get_resources')
                .then(response => response.json())
                .then(data => {
                    updateSelects(data);
                })
                .catch(error => {
                    console.error('åŠ è½½èµ„æºå¤±è´¥:', error);
                });
        }
        
        function updateSelects(resources) {
            // Update group select
            const groupSelect = document.getElementById('group-select');
            groupSelect.innerHTML = '<option value="">é€‰æ‹©ç”¨æˆ·ç»„</option>';
            
            if (resources.groups) {
                resources.groups.forEach(group => {
                    const option = document.createElement('option');
                    option.value = group.id;
                    option.textContent = `${group.name} (${group.users}ä¸ªç”¨æˆ·)`;
                    groupSelect.appendChild(option);
                });
            }
            
            // Update template select
            const templateSelect = document.getElementById('template-select');
            templateSelect.innerHTML = '<option value="">é€‰æ‹©é‚®ä»¶æ¨¡æ¿</option>';
            
            if (resources.templates) {
                resources.templates.forEach(template => {
                    const option = document.createElement('option');
                    option.value = template.id;
                    option.textContent = template.name;
                    templateSelect.appendChild(option);
                });
            }
            
            // Update page select
            const pageSelect = document.getElementById('page-select');
            pageSelect.innerHTML = '<option value="">é€‰æ‹©é’“é±¼é¡µé¢</option>';
            
            if (resources.pages) {
                resources.pages.forEach(page => {
                    const option = document.createElement('option');
                    option.value = page.id;
                    option.textContent = page.name;
                    pageSelect.appendChild(option);
                });
            }
        }
        
        function handleCreateGroup(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            
            fetch('/create_group', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showAlert(data.message);
                    e.target.reset();
                    loadResources(); // Refresh resources
                } else {
                    showAlert(data.message, 'error');
                }
            })
            .catch(error => {
                showAlert('åˆ›å»ºå¤±è´¥: ' + error.message, 'error');
            });
        }
        
        function handleGenerateContent(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            
            showAlert('æ­£åœ¨ç”Ÿæˆå†…å®¹ï¼Œè¯·ç¨å€™...', 'info');
            
            fetch('/generate_content', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showAlert(data.message);
                    loadResources(); // Refresh resources
                } else {
                    showAlert(data.message, 'error');
                }
            })
            .catch(error => {
                showAlert('ç”Ÿæˆå¤±è´¥: ' + error.message, 'error');
            });
        }
        
        function handleUpload(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            
            fetch('/upload_template', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showAlert(data.message);
                    e.target.reset();
                    loadResources(); // Refresh resources
                } else {
                    showAlert(data.message, 'error');
                }
            })
            .catch(error => {
                showAlert('ä¸Šä¼ å¤±è´¥: ' + error.message, 'error');
            });
        }
        
        function handleLaunchCampaign(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            
            if (!confirm('ç¡®è®¤å¯åŠ¨é’“é±¼æ´»åŠ¨å—ï¼Ÿ')) {
                return;
            }
            
            fetch('/launch_campaign', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showAlert(data.message);
                    e.target.reset();
                } else {
                    showAlert(data.message, 'error');
                }
            })
            .catch(error => {
                showAlert('å¯åŠ¨å¤±è´¥: ' + error.message, 'error');
            });
        }
        
        function analyzeRealEmail(filename) {
            const formData = new FormData();
            formData.append('filename', filename);
            
            fetch('/analyze_real_email', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const analysis = data.analysis;
                    alert(`é‚®ä»¶åˆ†æç»“æœ:\n\nä¸»é¢˜: ${analysis.subject}\nå‘ä»¶äºº: ${analysis.sender}\nç±»å‹: ${analysis.content_type}\n\né¢„è§ˆ:\n${analysis.preview}`);
                } else {
                    showAlert(data.message, 'error');
                }
            })
            .catch(error => {
                showAlert('åˆ†æå¤±è´¥: ' + error.message, 'error');
            });
        }
        
        function batchOperation(operation) {
            const formData = new FormData();
            formData.append('operation', operation);
            
            if (operation === 'generate_multiple_templates') {
                const count = prompt('ç”Ÿæˆå¤šå°‘ä¸ªæ¨¡æ¿? (1-5)', '3');
                if (!count || isNaN(count)) return;
                formData.append('count', count);
            }
            
            showAlert('æ­£åœ¨æ‰§è¡Œæ‰¹é‡æ“ä½œï¼Œè¯·ç¨å€™...', 'info');
            
            fetch('/batch_operation', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showAlert(data.message);
                    loadResources(); // Refresh resources
                } else {
                    showAlert(data.message, 'error');
                }
            })
            .catch(error => {
                showAlert('æ“ä½œå¤±è´¥: ' + error.message, 'error');
            });
        }
        
        function refreshTemplates() {
            location.reload();
        }
        
        function refreshAll() {
            loadResources();
            
            // Refresh status
            fetch('/api/status')
                .then(response => response.json())
                .then(data => {
                    console.log('çŠ¶æ€å·²åˆ·æ–°', data);
                });
            
            showAlert('æ•°æ®å·²åˆ·æ–°', 'info');
        }
        
        // Real email sending functions
        function showSendRealEmailModal(filename, subject) {
            const modal = document.getElementById('send-real-email-modal');
            const modalFilename = document.getElementById('modal-filename');
            const modalEmailInfo = document.getElementById('modal-email-info');
            const modalCampaignName = document.getElementById('modal-campaign-name');
            const modalGroupSelect = document.getElementById('modal-group-select');
            
            // Set values
            modalFilename.value = filename;
            modalEmailInfo.innerHTML = `
                <strong>ğŸ“§ ${subject}</strong><br>
                <small>æ–‡ä»¶: ${filename}</small>
            `;
            
            // Generate campaign name with timestamp
            const timestamp = new Date().toISOString().slice(0, 16).replace('T', '_').replace(/[:]/g, '');
            let campaignName = '';
            if (filename.includes('metamask') || filename.includes('ç›‘æ§')) {
                campaignName = `MetaMaskå®‰å…¨è­¦å‘Š_${timestamp}`;
            } else if (filename.includes('aws')) {
                campaignName = `AWSé€šçŸ¥_${timestamp}`;
            } else {
                campaignName = `çœŸå®é‚®ä»¶æ´»åŠ¨_${timestamp}`;
            }
            modalCampaignName.value = campaignName;
            
            // Populate group select
            fetch('/get_resources')
                .then(response => response.json())
                .then(data => {
                    modalGroupSelect.innerHTML = '<option value="">é€‰æ‹©ç”¨æˆ·ç»„</option>';
                    if (data.groups) {
                        data.groups.forEach(group => {
                            const option = document.createElement('option');
                            option.value = group.id;
                            option.textContent = `${group.name} (${group.users}ä¸ªç”¨æˆ·)`;
                            modalGroupSelect.appendChild(option);
                        });
                    }
                });
            
            // Show modal
            modal.style.display = 'flex';
        }
        
        function closeSendRealEmailModal() {
            const modal = document.getElementById('send-real-email-modal');
            modal.style.display = 'none';
        }
        
        function selectModalServer(serverKey) {
            // Remove previous selection in modal
            const modalOptions = document.querySelectorAll('#send-real-email-modal .server-option');
            modalOptions.forEach(el => el.classList.remove('selected'));
            
            // Add selection to clicked server in modal
            const modalOption = document.querySelector(`#send-real-email-modal [data-server="${serverKey}"]`);
            if (modalOption) {
                modalOption.classList.add('selected');
            }
            
            // Update hidden input
            document.getElementById('modal-selected-server').value = serverKey;
            modalSelectedServer = serverKey;
        }
        
        function handleSendRealEmail(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            
            if (!confirm('ç¡®è®¤å‘é€çœŸå®é‚®ä»¶è¿›è¡Œé’“é±¼æµ‹è¯•å—ï¼Ÿè¿™å°†åˆ›å»ºå®Œæ•´çš„é’“é±¼æ´»åŠ¨ã€‚')) {
                return;
            }
            
            showAlert('æ­£åœ¨åˆ›å»ºçœŸå®é‚®ä»¶é’“é±¼æ´»åŠ¨ï¼Œè¯·ç¨å€™...', 'info');
            
            fetch('/send_real_email', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showAlert(data.message);
                    if (data.details) {
                        const details = data.details;
                        setTimeout(() => {
                            alert(`æ´»åŠ¨åˆ›å»ºæˆåŠŸï¼\n\næ´»åŠ¨ID: ${details.campaign_id}\næ¨¡æ¿: ${details.template_name}\né¡µé¢: ${details.page_name}\næ”»å‡»ç±»å‹: ${details.attack_type}\nç›®æ ‡URL: ${details.target_url}\né‚®ä»¶ç±»å‹: ${details.email_type}`);
                        }, 1000);
                    }
                    closeSendRealEmailModal();
                    loadResources(); // Refresh resources
                } else {
                    showAlert(data.message, 'error');
                }
            })
            .catch(error => {
                showAlert('å‘é€å¤±è´¥: ' + error.message, 'error');
            });
        }
        
        // Close modal when clicking outside
        document.addEventListener('click', function(e) {
            const modal = document.getElementById('send-real-email-modal');
            if (e.target === modal) {
                closeSendRealEmailModal();
            }
        });
        
        // Auto refresh every 30 seconds
        setInterval(function() {
            fetch('/api/status')
                .then(response => response.json())
                .then(data => {
                    // Update status indicators
                    const gophishIndicator = document.querySelector('.status-bar .status-indicator');
                    if (gophishIndicator) {
                        gophishIndicator.className = `status-indicator ${data.gophish ? 'status-online' : 'status-offline'}`;
                    }
                });
        }, 30000);
    </script>
</body>
</html>
